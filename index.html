<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Guia completo para aprovação no ENEM 2026. Plataforma de estudos com IA conectada.">
    <meta name="author" content="Alessandro Mozer">
    <meta name="theme-color" content="#020617">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Jornada para a Faculdade">
    <meta property="og:description" content="Guia interativo e gamificado para o ENEM 2026.">
    <meta property="og:type" content="website">
    
    <title>Jornada para a Faculdade | Guia 2026</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind (CDN Prototipagem) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            --bg-deep: #020617;
            --rose-primary: #e11d48;
            --rose-glow: rgba(225, 29, 72, 0.4);
            --glass-bg: rgba(15, 23, 42, 0.92);
            --glass-border: rgba(255, 255, 255, 0.08);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        body { 
            background-color: var(--bg-deep); 
            color: #e2e8f0; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            overflow-x: hidden; 
            -webkit-font-smoothing: antialiased;
            /* Previne highlight azul padrão no mobile ao tocar */
            -webkit-tap-highlight-color: transparent;
        }

        /* Acessibilidade: Focus Ring Visível */
        :focus-visible {
            outline: 2px solid var(--rose-primary);
            outline-offset: 2px;
            border-radius: 4px;
            z-index: 50;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--rose-primary); }

        .glass-panel { 
            background: var(--glass-bg); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px); 
            border: 1px solid var(--glass-border); 
        }
        
        .hero-bg { 
            background: linear-gradient(to bottom, transparent, var(--bg-deep)), 
                        linear-gradient(to right, rgba(2,6,23,0.95), rgba(2,6,23,0.7)), 
                        url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&q=80&w=2000'); 
            background-size: cover; 
            background-position: center top; 
            background-attachment: scroll; 
        }
        @media (min-width: 1024px) {
            .hero-bg { background-attachment: fixed; }
        }

        /* Reduced Motion Respect */
        @media (prefers-reduced-motion: no-preference) {
            .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
            .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 20px -10px var(--rose-glow); }
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .card-hover { transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1), box-shadow 0.3s ease, border-color 0.3s ease; }
        
        /* Markdown Chat */
        .prose-chat p { margin-bottom: 0.75em; line-height: 1.6; }
        .prose-chat strong { color: white; font-weight: 700; }
        .prose-chat ul { list-style: disc; padding-left: 1.2em; margin-bottom: 0.75em; }
        .prose-chat a { color: #fb7185; text-decoration: underline; }

        /* Touch Target Otimizado para Mobile */
        .touch-target { 
            min-height: 48px; /* Aumentado para melhor toque */
            min-width: 48px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer;
            user-select: none; /* Previne seleção de texto acidental no botão */
        }
        
        /* Feedback visual de clique (afunda levemente) */
        .btn-press:active { transform: scale(0.96); }

        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
        .pb-safe { padding-bottom: var(--safe-bottom); }
    </style>
</head>
<body class="selection:bg-rose-600 selection:text-white">

    <!-- TOAST SYSTEM -->
    <div id="toast-container" aria-live="polite" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 z-[120] flex flex-col gap-2 w-[90%] max-w-sm pointer-events-none"></div>

    <!-- NAVBAR -->
    <nav class="fixed w-full z-50 glass-panel border-b-0 top-0 shadow-lg" role="navigation" aria-label="Menu Principal">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 md:h-20">
                <!-- Logo -->
                <a href="#" class="flex items-center gap-3 group focus:outline-none focus:ring-2 focus:ring-rose-500 rounded-lg p-1 btn-press" onclick="window.scrollTo({top:0, behavior:'smooth'}); return false;">
                    <div class="w-10 h-10 bg-rose-600 rounded-lg flex items-center justify-center shadow-lg shadow-rose-900/50 group-hover:scale-105 transition-transform">
                        <i class="fas fa-play text-white text-sm"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-black tracking-tighter italic text-white leading-none">JORNADA</h1>
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block group-hover:text-white transition-colors">Alessandro Mozer</span>
                    </div>
                </a>

                <!-- Desktop Nav -->
                <div class="hidden md:flex items-center gap-6">
                    <div class="relative group">
                        <label for="desktop-search" class="sr-only">Buscar episódio</label>
                        <input type="text" id="desktop-search" placeholder="Buscar..." class="bg-slate-900/50 border border-white/10 rounded-full py-2 pl-10 pr-4 text-xs w-48 focus:w-64 transition-all focus:border-rose-500 focus:outline-none text-white focus:bg-slate-900">
                        <i class="fas fa-search absolute left-3.5 top-2.5 text-slate-500 text-xs" aria-hidden="true"></i>
                    </div>

                    <div class="h-6 w-px bg-white/10 mx-2" aria-hidden="true"></div>

                    <!-- Stats -->
                    <div class="flex items-center gap-5 text-xs font-bold uppercase tracking-wide text-slate-400" role="status">
                        <div class="flex items-center gap-1.5" title="Dias seguidos" tabindex="0">
                            <i class="fas fa-fire text-orange-500 text-sm" aria-hidden="true"></i> <span id="streak-counter">0</span> <span class="sr-only">dias</span>
                        </div>
                        <div class="flex items-center gap-1.5" title="Nível" tabindex="0">
                            <i class="fas fa-trophy text-yellow-500 text-sm" aria-hidden="true"></i> <span id="user-level">Novato</span>
                        </div>
                    </div>

                    <button id="btn-tools-desktop" class="text-slate-300 hover:text-white transition p-2 hover:bg-white/5 rounded-full touch-target btn-press" aria-label="Abrir Ferramentas">
                        <i class="fas fa-toolbox text-lg"></i>
                    </button>
                    <button id="btn-chat-desktop" class="bg-gradient-to-r from-rose-600 to-rose-500 hover:from-rose-500 hover:to-rose-400 text-white px-6 py-2.5 rounded-full transition shadow-lg shadow-rose-900/20 text-xs font-bold flex items-center gap-2 hover:scale-105 btn-press border border-white/10">
                        <i class="fas fa-globe"></i> Mentor IA
                    </button>
                </div>

                <!-- Mobile Trigger -->
                <button id="btn-mobile-menu" class="md:hidden text-white text-xl p-2 touch-target hover:bg-white/5 rounded-lg transition btn-press" aria-label="Abrir Menu" aria-expanded="false" aria-controls="mobile-menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        <!-- Progress Bar -->
        <div class="w-full h-1 bg-slate-800 relative" role="progressbar" aria-label="Progresso Geral" aria-valuemin="0" aria-valuemax="100">
            <div id="global-progress-bar" class="h-full bg-gradient-to-r from-rose-600 to-orange-500 w-0 transition-all duration-1000 shadow-[0_0_10px_rgba(225,29,72,0.6)]"></div>
        </div>
    </nav>

    <!-- MOBILE DRAWER -->
    <div id="mobile-menu-overlay" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden transition-opacity duration-300" aria-hidden="true"></div>
    <div id="mobile-menu" class="fixed inset-y-0 right-0 z-[70] w-[85%] max-w-sm bg-[#050505] border-l border-white/10 shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col backdrop-blur-xl" aria-hidden="true">
        <div class="p-5 flex justify-between items-center border-b border-white/10 bg-slate-900/50">
            <span class="text-white font-bold text-lg tracking-widest italic">MENU</span>
            <button id="btn-close-mobile" class="text-white text-2xl touch-target btn-press" aria-label="Fechar Menu"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-6 flex-grow overflow-y-auto">
             <label for="mobile-search" class="sr-only">Pesquisar</label>
             <input type="text" id="mobile-search" placeholder="O que você quer aprender?" class="w-full bg-slate-800 border border-white/10 rounded-xl py-4 px-4 text-white mb-8 focus:border-rose-500 focus:outline-none focus:ring-1 focus:ring-rose-500 transition">
             <nav class="flex flex-col gap-3">
                 <!-- Botões de navegação Mobile corrigidos com IDs para JS -->
                 <button class="nav-mobile-btn flex items-center gap-4 hover:bg-white/5 p-4 rounded-xl text-slate-300 hover:text-white transition w-full text-left touch-target btn-press" data-action="catalog">
                    <i class="fas fa-list w-6 text-center text-rose-500 text-lg"></i> <span class="text-base font-bold">Catálogo</span>
                 </button>
                 <button class="nav-mobile-btn flex items-center gap-4 hover:bg-white/5 p-4 rounded-xl text-slate-300 hover:text-white transition w-full text-left touch-target btn-press" data-action="favs">
                    <i class="fas fa-heart w-6 text-center text-rose-500 text-lg"></i> <span class="text-base font-bold">Favoritos</span>
                 </button>
                 <button class="nav-mobile-btn flex items-center gap-4 hover:bg-white/5 p-4 rounded-xl text-slate-300 hover:text-white transition w-full text-left touch-target btn-press" data-action="tools">
                    <i class="fas fa-calculator w-6 text-center text-rose-500 text-lg"></i> <span class="text-base font-bold">Ferramentas</span>
                 </button>
                 <button class="nav-mobile-btn flex items-center gap-4 hover:bg-white/5 p-4 rounded-xl text-slate-300 hover:text-white transition w-full text-left touch-target btn-press" data-action="chat">
                    <i class="fas fa-robot w-6 text-center text-rose-500 text-lg"></i> <span class="text-base font-bold">Mentor IA</span>
                 </button>
             </nav>
        </div>
        <div class="p-4 border-t border-white/10 text-center pb-safe">
            <p class="text-[10px] text-slate-600 uppercase tracking-widest">Versão 11.0 • Profissional</p>
        </div>
    </div>

    <!-- HERO -->
    <header id="home" class="relative min-h-[85vh] flex items-center justify-center hero-bg px-4 py-24">
        <div class="text-center max-w-5xl mx-auto w-full animate-fade-in">
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass-panel border border-rose-500/30 mb-8 shadow-lg">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                <span class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-rose-200">Plataforma Atualizada • 2026</span>
            </div>
            
            <h1 class="text-4xl sm:text-6xl md:text-8xl font-black text-white leading-[0.95] tracking-tighter mb-8 drop-shadow-2xl">
                SUA JORNADA <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-rose-500 via-rose-400 to-orange-400">PARA O FUTURO.</span>
            </h1>
            
            <p class="text-sm sm:text-base md:text-xl text-slate-300 max-w-2xl mx-auto leading-relaxed mb-10 font-light px-4">
                10 Temporadas completas. Repertório sociocultural validado. Ferramentas de alta performance e IA conectada.
            </p>

            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 w-full px-4">
                <button id="btn-hero-start" class="w-full sm:w-auto bg-rose-600 hover:bg-rose-700 text-white px-8 py-4 rounded-xl font-bold text-sm tracking-wide transition transform hover:scale-105 shadow-[0_0_20px_rgba(225,29,72,0.4)] flex items-center justify-center gap-3 touch-target btn-press focus:ring-2 focus:ring-white">
                    <i class="fas fa-play" aria-hidden="true"></i> INICIAR MARATONA
                </button>
                <button id="btn-hero-chat" class="w-full sm:w-auto glass-panel hover:bg-white/10 text-white px-8 py-4 rounded-xl font-bold text-sm transition flex items-center justify-center gap-3 touch-target btn-press focus:ring-2 focus:ring-rose-500">
                    <i class="fas fa-search" aria-hidden="true"></i> PESQUISAR NO GOOGLE IA
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main id="catalogo" class="max-w-7xl mx-auto px-4 md:px-8 py-24 space-y-20"></main>

    <!-- FOOTER -->
    <footer class="border-t border-white/5 bg-[#010101] py-20 px-4 text-center">
        <div class="max-w-3xl mx-auto space-y-6">
            <h2 class="text-3xl font-black italic text-slate-800 select-none">JORNADA</h2>
            <p class="text-slate-500 text-sm">Desenvolvido com rigor pedagógico por Alessandro Mozer.<br>Conteúdo atualizado.</p>
        </div>
    </footer>

    <!-- MODAL EPISÓDIO -->
    <div id="episode-modal" class="fixed inset-0 z-[80] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-0 md:p-4 backdrop-blur-md" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="absolute inset-0 bg-black/90" id="modal-backdrop"></div>
        <div class="relative bg-slate-900 w-full h-full md:h-auto md:max-h-[90vh] md:rounded-3xl border border-white/10 shadow-2xl flex flex-col md:flex-row overflow-hidden max-w-[1400px]">
            
            <!-- Mobile Header -->
            <div class="md:hidden flex justify-between items-center p-4 border-b border-white/10 bg-slate-950 shrink-0">
                <span class="text-rose-500 text-[10px] font-bold uppercase" id="modal-mobile-tag">TEMP 1</span>
                <button id="btn-modal-close-mobile" class="text-white text-2xl p-2 touch-target btn-press" aria-label="Fechar Modal"><i class="fas fa-times"></i></button>
            </div>

            <!-- Desktop Close -->
            <button id="btn-modal-close-desktop" class="hidden md:flex absolute top-4 right-4 w-10 h-10 bg-black/50 hover:bg-rose-600 rounded-full text-white items-center justify-center transition z-50 border border-white/10 touch-target btn-press focus:ring-2 focus:ring-white" aria-label="Fechar Modal"><i class="fas fa-times"></i></button>

            <!-- Sidebar -->
            <div class="hidden md:flex flex-col w-96 bg-[#0a0a0a] p-8 border-r border-white/5 overflow-y-auto">
                <span id="modal-tag" class="text-rose-500 text-[10px] font-bold uppercase tracking-widest mb-3 block">TEMPORADA 1</span>
                <h2 id="modal-title" class="text-3xl font-black text-white mb-6 leading-tight">Título</h2>
                
                <div class="space-y-4">
                    <button id="btn-concluir" class="w-full py-4 bg-slate-800 hover:bg-green-600 text-white rounded-xl font-bold text-xs uppercase tracking-widest transition flex items-center justify-center gap-3 border border-white/5 group touch-target btn-press focus:ring-2 focus:ring-green-500">
                        <i class="far fa-circle group-hover:scale-110 transition"></i> <span>Concluir</span>
                    </button>
                    <a id="btn-video" href="#" target="_blank" class="w-full py-4 bg-rose-600 hover:bg-rose-700 text-white rounded-xl font-bold text-xs uppercase tracking-widest transition flex items-center justify-center gap-3 shadow-lg touch-target btn-press focus:ring-2 focus:ring-white">
                        <i class="fab fa-youtube"></i> Assistir Aula
                    </a>
                </div>

                <div class="mt-auto pt-8 space-y-6">
                    <!-- Pomodoro Widget -->
                    <div class="bg-slate-900 p-4 rounded-xl border border-white/5">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] font-bold text-slate-400 uppercase">Focus Timer</span>
                            <span id="pomo-time" class="text-white font-mono font-bold" aria-live="off">25:00</span>
                        </div>
                        <div class="flex gap-2">
                            <button id="btn-pomo-toggle" class="flex-1 bg-slate-800 text-[10px] text-rose-400 font-bold py-2 rounded hover:bg-slate-700 focus:outline-none focus:ring-1 focus:ring-rose-500 btn-press">INICIAR</button>
                            <button id="btn-pomo-reset" class="bg-slate-800 text-slate-400 px-3 rounded hover:bg-slate-700 focus:outline-none focus:ring-1 focus:ring-slate-500 btn-press" aria-label="Resetar Timer"><i class="fas fa-redo text-xs"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-grow bg-[#050505] flex flex-col h-full relative">
                <div class="flex-grow overflow-y-auto custom-scrollbar p-6 md:p-12 pb-32 md:pb-12" id="modal-content-scroll">
                    <div id="modal-body" class="prose prose-invert prose-lg max-w-3xl mx-auto text-slate-300 leading-loose"></div>
                </div>
            </div>

             <!-- Mobile Sticky Footer -->
             <div class="md:hidden absolute bottom-0 w-full bg-slate-950 border-t border-white/10 p-4 pb-safe flex gap-3 z-20 shadow-2xl">
                 <button id="btn-concluir-mobile" class="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold text-xs uppercase touch-target btn-press focus:ring-2 focus:ring-green-500 flex items-center justify-center gap-2">Concluir</button>
                 <a id="btn-video-mobile" href="#" target="_blank" class="flex-1 bg-rose-600 text-white py-3 rounded-xl font-bold text-xs uppercase flex items-center justify-center gap-2 touch-target btn-press focus:ring-2 focus:ring-white"><i class="fab fa-youtube"></i> Aula</a>
             </div>
        </div>
    </div>

    <!-- CHAT WINDOW (Bottom Sheet on Mobile) -->
    <div id="chat-window" class="fixed inset-0 md:inset-auto md:bottom-6 md:right-6 md:w-[450px] md:h-[600px] bg-[#0a0a0a] z-[90] md:rounded-3xl shadow-2xl transform translate-y-[110%] transition-transform duration-300 border border-white/10 flex flex-col safe-area-bottom" role="dialog" aria-label="Mentor IA">
        <div class="p-4 bg-gradient-to-r from-rose-700 to-rose-600 flex justify-between items-center md:rounded-t-3xl cursor-pointer shrink-0" id="chat-header">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white"><i class="fas fa-globe"></i></div>
                <div><h3 class="font-bold text-white text-sm">Mentor IA</h3><p class="text-[9px] text-white/90 font-bold uppercase">Online</p></div>
            </div>
            <button id="btn-chat-close" class="text-white p-2 touch-target btn-press" aria-label="Fechar Chat"><i class="fas fa-chevron-down"></i></button>
        </div>
        <div id="chat-messages" class="flex-grow overflow-y-auto p-4 space-y-4 bg-[#050505] pb-24 md:pb-4 custom-scrollbar"></div>
        <div class="p-4 bg-slate-900 border-t border-white/5 pb-safe shrink-0">
            <form id="chat-form" class="relative">
                <label for="chat-input" class="sr-only">Digite sua dúvida</label>
                <input type="text" id="chat-input" placeholder="Pergunte algo..." class="w-full bg-black border border-slate-700 rounded-xl py-3 pl-4 pr-12 text-sm text-white focus:border-rose-500 focus:outline-none transition">
                <button type="submit" class="absolute right-2 top-2 bg-rose-600 hover:bg-rose-500 w-8 h-8 rounded-lg text-white flex items-center justify-center touch-target btn-press" aria-label="Enviar"><i class="fas fa-paper-plane text-xs"></i></button>
            </form>
        </div>
    </div>

    <!-- FERRAMENTAS MODAL -->
    <div id="tools-modal" class="fixed inset-0 z-[85] hidden bg-black/90 backdrop-blur-md items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="tools-title">
        <div class="bg-slate-900 w-full max-w-lg rounded-2xl border border-white/10 p-6 relative animate-fade-in shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 id="tools-title" class="text-white font-bold text-lg">Ferramentas</h2>
                <button id="btn-tools-close" class="text-slate-400 hover:text-white p-2 touch-target btn-press" aria-label="Fechar Ferramentas"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div class="bg-slate-800 p-4 rounded-xl">
                    <h3 class="text-white text-sm font-bold mb-2">Calculadora Média</h3>
                    <div class="grid grid-cols-5 gap-2 mb-3">
                        <label for="n1" class="sr-only">Linguagens</label>
                        <input id="n1" type="number" placeholder="L" class="bg-slate-900 text-white rounded p-2 text-xs text-center border border-white/10 focus:border-rose-500 outline-none">
                        <label for="n2" class="sr-only">Humanas</label>
                        <input id="n2" type="number" placeholder="H" class="bg-slate-900 text-white rounded p-2 text-xs text-center border border-white/10 focus:border-rose-500 outline-none">
                        <label for="n3" class="sr-only">Natureza</label>
                        <input id="n3" type="number" placeholder="N" class="bg-slate-900 text-white rounded p-2 text-xs text-center border border-white/10 focus:border-rose-500 outline-none">
                        <label for="n4" class="sr-only">Matemática</label>
                        <input id="n4" type="number" placeholder="M" class="bg-slate-900 text-white rounded p-2 text-xs text-center border border-white/10 focus:border-rose-500 outline-none">
                        <label for="n5" class="sr-only">Redação</label>
                        <input id="n5" type="number" placeholder="R" class="bg-slate-900 border border-rose-500 text-white rounded p-2 text-xs text-center focus:border-white outline-none">
                    </div>
                    <button id="btn-calc" class="w-full bg-rose-600 hover:bg-rose-700 text-white font-bold py-3 rounded text-xs transition touch-target btn-press">CALCULAR</button>
                    <div id="res-calc" class="mt-2 text-center text-white font-bold hidden animate-fade-in p-2 bg-slate-900 rounded"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * ------------------------------------------------------------------
         * CORE ARCHITECTURE (V11 - INTERACTION FIX)
         * ------------------------------------------------------------------
         */

        // 1. HELPERS: SECURITY & A11Y
        class Security {
            static sanitize(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }
        }

        class DOMHelper {
            static focusTrap(modalId) {
                const modal = document.getElementById(modalId);
                const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if(focusable.length) focusable[0].focus();
            }
        }

        // 2. STATE MANAGEMENT
        class StateManager {
            constructor() {
                this.state = {
                    progress: JSON.parse(localStorage.getItem('mozer_progress')) || [],
                    favorites: JSON.parse(localStorage.getItem('mozer_favs')) || [],
                    notes: JSON.parse(localStorage.getItem('mozer_notes')) || {},
                    streak: parseInt(localStorage.getItem('mozer_streak')) || 0,
                    lastLogin: localStorage.getItem('mozer_last_login')
                };
                this.listeners = [];
            }

            subscribe(listener) { this.listeners.push(listener); }
            notify(changedKey, value) { this.listeners.forEach(fn => fn(changedKey, value)); }

            update(key, value) {
                this.state[key] = value;
                localStorage.setItem(`mozer_${key === 'favorites' ? 'favs' : key}`, JSON.stringify(value));
                this.notify(key, value);
            }

            checkStreak() {
                const today = new Date().toDateString();
                if (this.state.lastLogin !== today) {
                    const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                    if (this.state.lastLogin === yesterday.toDateString()) this.update('streak', this.state.streak + 1);
                    else this.update('streak', 1);
                    localStorage.setItem('mozer_last_login', today);
                }
            }
        }

        // 3. DATA
        const CatalogDB = [
            {
                id: "t1", title: "T1: O Sistema", desc: "Regras do jogo: TRI, SISU e Cotas.",
                episodes: [
                    { id: "1-1", title: "O Código Secreto TRI", content: "<p>O ENEM é uma prova de coerência, não apenas de acertos.</p><p><strong>Estratégia:</strong> Garanta as questões fáceis.</p>", videoQuery: "como funciona tri enem", source: "https://inep.gov.br" },
                    { id: "1-2", title: "SISU vs ProUni", content: "<p>SISU: Públicas. ProUni: Bolsas Privadas.</p>", videoQuery: "diferença sisu prouni", source: "#" }
                ]
            },
            {
                id: "t2", title: "T2: Como Estudar", desc: "Técnicas de neurociência.",
                episodes: [
                    { id: "2-1", title: "Estudo Ativo", content: "<p>Flashcards > Resumos passivos.</p>", videoQuery: "estudo ativo", source: "#" },
                    { id: "2-2", title: "Pomodoro", content: "<p>25 min foco / 5 min pausa.</p>", videoQuery: "pomodoro timer", source: "#" }
                ]
            },
            {
                id: "t3", title: "T3: Redação 1000", desc: "Estrutura e Repertório.",
                episodes: [
                    { id: "3-1", title: "GOMIF", content: "<p>Agente, Ação, Meio, Efeito, Detalhe.</p>", videoQuery: "gomif redação", source: "#" },
                    { id: "3-2", title: "Repertório: Desigualdade", content: "<p>Filmes: Parasita, Coringa.</p>", videoQuery: "analise parasita redação", source: "#" }
                ]
            },
            { id: "t4", title: "T4: Exatas", desc: "Matemática e Natureza.", episodes: [{id: "4-1", title: "Matemática Básica", content: "Regra de 3.", videoQuery: "matematica basica", source: "#"}] },
            { id: "t5", title: "T5: Humanas", desc: "História e Geografia.", episodes: [{id: "5-1", title: "Brasil Colônia", content: "Ciclos econômicos.", videoQuery: "brasil colonia", source: "#"}] },
            { id: "t6", title: "T6: Saúde Mental", desc: "Ansiedade e Sono.", episodes: [{id: "6-1", title: "Higiene do Sono", content: "Dormir é estudar.", videoQuery: "sono estudos", source: "#"}] },
            { id: "t7", title: "T7: Reta Final", desc: "Simulados.", episodes: [{id: "7-1", title: "Estratégia", content: "Comece pelas fáceis.", videoQuery: "estrategia enem", source: "#"}] },
            { id: "t8", title: "T8: Dia da Prova", desc: "Kit Sobrevivência.", episodes: [{id: "8-1", title: "O que levar", content: "Caneta preta.", videoQuery: "o que levar enem", source: "#"}] },
            { id: "t9", title: "T9: Pós-Prova", desc: "TRI e SISU.", episodes: [{id: "9-1", title: "Nota", content: "Simuladores.", videoQuery: "sisu simulador", source: "#"}] },
            { id: "t10", title: "T10: A Glória", desc: "Matrícula.", episodes: [{id: "10-1", title: "Documentos", content: "RG e Histórico.", videoQuery: "documentos matricula", source: "#"}] }
        ];

        // 4. APP CONTROLLER
        class AppController {
            constructor() {
                this.state = new StateManager();
                this.searchTimeout = null;
                // Expose to window for inline HTML onclicks if needed (though we're moving away from that)
                window.app = this; 
                this.init();
            }

            init() {
                this.renderCatalog();
                this.setupEvents();
                // Otimização: Só re-renderiza o necessário
                this.state.subscribe((key, val) => this.handleStateChange(key, val));
                this.state.checkStreak();
                this.updateGlobalStats();
                
                // Inicializa estado visual
                this.state.state.progress.forEach(id => this.updateCardUI(id, true));
            }

            renderCatalog(items = CatalogDB) {
                const container = document.getElementById('catalogo');
                container.innerHTML = items.map(season => `
                    <section class="animate-fade-in">
                        <div class="flex items-end gap-3 mb-6 border-b border-white/5 pb-2">
                            <div class="h-8 w-1 bg-gradient-to-b from-rose-600 to-orange-500 rounded-full"></div>
                            <div>
                                <h2 class="text-2xl font-black text-white italic tracking-tight uppercase">${season.title}</h2>
                                <p class="text-xs text-slate-400 font-medium">${season.desc}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                            ${season.episodes.map(ep => `
                                <article id="card-${ep.id}" class="episode-card bg-slate-900/50 backdrop-blur-sm p-5 rounded-2xl border border-white/5 cursor-pointer card-hover group relative overflow-hidden focus:outline-none focus:ring-2 focus:ring-rose-500 transition-all btn-press" 
                                    role="button" tabindex="0" data-sid="${season.id}" data-eid="${ep.id}">
                                    <div class="flex justify-between items-start mb-4 relative z-10">
                                        <span class="text-rose-400 font-black text-[10px] tracking-widest uppercase bg-rose-500/10 px-2 py-1 rounded border border-rose-500/20">EP ${ep.id.split('-')[1]}</span>
                                        <div class="relative"><i id="icon-check-${ep.id}" class="far fa-circle text-slate-600 text-lg transition duration-300"></i></div>
                                    </div>
                                    <h3 class="text-base font-bold text-white mb-2 leading-tight group-hover:text-rose-200 transition relative z-10">${ep.title}</h3>
                                    <div class="w-full h-1 bg-slate-800 rounded-full mt-4 overflow-hidden relative z-10">
                                        <div id="prog-${ep.id}" class="h-full bg-gradient-to-r from-green-500 to-emerald-400 w-0 transition-all duration-1000"></div>
                                    </div>
                                </article>
                            `).join('')}
                        </div>
                    </section>
                `).join('');
                
                // Re-attach listeners for cards properly (No inline onclick in HTML string to avoid scope issues)
                document.querySelectorAll('.episode-card').forEach(card => {
                    card.addEventListener('click', () => this.openEpisode(card.dataset.sid, card.dataset.eid));
                    card.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); this.openEpisode(card.dataset.sid, card.dataset.eid); }});
                });
            }

            handleStateChange(key, value) {
                if(key === 'progress') {
                    document.querySelectorAll('.episode-card').forEach(card => {
                        const eid = card.dataset.eid;
                        const isDone = value.includes(eid);
                        this.updateCardUI(eid, isDone);
                    });
                    this.updateGlobalStats();
                } else if (key === 'streak') {
                    document.getElementById('streak-counter').textContent = value;
                }
            }

            updateCardUI(id, isDone) {
                const icon = document.getElementById(`icon-check-${id}`);
                const bar = document.getElementById(`prog-${id}`);
                if(icon && bar) {
                    if(isDone) {
                        icon.className = "fas fa-check-circle text-green-500 text-lg scale-110";
                        bar.style.width = "100%";
                    } else {
                        icon.className = "far fa-circle text-slate-600 text-lg";
                        bar.style.width = "0%";
                    }
                }
            }

            updateGlobalStats() {
                let total = 0; CatalogDB.forEach(s => total += s.episodes.length);
                const percent = Math.round((this.state.state.progress.length / total) * 100);
                document.getElementById('global-progress-bar').style.width = `${percent}%`;
                document.getElementById('user-level').textContent = percent > 80 ? "Mestre" : percent > 30 ? "Veterano" : "Novato";
            }

            setupEvents() {
                // UI Toggles
                this.bindToggle('btn-mobile-menu', 'mobile-menu', 'translate-x-full');
                this.bindToggle('btn-close-mobile', 'mobile-menu', 'translate-x-full');
                this.bindToggle('mobile-menu-overlay', 'mobile-menu', 'translate-x-full');
                
                this.bindToggle('btn-chat-desktop', 'chat-window', 'translate-y-[110%]', 'translate-y-0');
                this.bindToggle('btn-hero-chat', 'chat-window', 'translate-y-[110%]', 'translate-y-0');
                this.bindToggle('btn-chat-close', 'chat-window', 'translate-y-[110%]', 'translate-y-0');
                this.bindToggle('chat-header', 'chat-window', 'translate-y-[110%]', 'translate-y-0');

                this.bindToggle('btn-tools-desktop', 'tools-modal', 'hidden', 'flex');
                this.bindToggle('btn-tools-close', 'tools-modal', 'hidden', 'flex');

                // Mobile Navigation Button Wiring (FIXED: Now they actually work)
                document.querySelectorAll('.nav-mobile-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const action = btn.dataset.action;
                        // Close menu first
                        document.getElementById('mobile-menu').classList.add('translate-x-full');
                        document.getElementById('mobile-menu-overlay').classList.add('hidden');
                        
                        // Execute action
                        setTimeout(() => {
                            if(action === 'catalog') window.scrollTo({top: 0, behavior: 'smooth'});
                            if(action === 'favs') this.showToast("Mostrando favoritos..."); // Mock feature
                            if(action === 'tools') { document.getElementById('tools-modal').classList.remove('hidden'); document.getElementById('tools-modal').classList.add('flex'); }
                            if(action === 'chat') { document.getElementById('chat-window').classList.remove('translate-y-[110%]'); document.getElementById('chat-window').classList.add('translate-y-0'); }
                        }, 200);
                    });
                });

                // Modal
                ['btn-modal-close-desktop', 'btn-modal-close-mobile', 'modal-backdrop'].forEach(id => {
                    document.getElementById(id).addEventListener('click', () => this.closeModal());
                });

                // Actions
                document.getElementById('btn-concluir').addEventListener('click', () => this.toggleComplete());
                document.getElementById('btn-concluir-mobile').addEventListener('click', () => this.toggleComplete());
                document.getElementById('btn-hero-start').addEventListener('click', () => document.getElementById('catalogo').scrollIntoView({behavior:'smooth'}));
                document.getElementById('btn-calc').addEventListener('click', () => this.calcMedia());
                document.getElementById('chat-form').addEventListener('submit', (e) => this.handleChat(e));
                
                // Search with Debounce
                document.getElementById('desktop-search').addEventListener('input', (e) => {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => this.search(e.target.value), 300);
                });
                document.getElementById('mobile-search').addEventListener('input', (e) => {
                     clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => this.search(e.target.value), 300);
                });
            }

            bindToggle(btnId, targetId, ...classes) {
                const btn = document.getElementById(btnId);
                if(btn) btn.addEventListener('click', () => {
                    const el = document.getElementById(targetId);
                    classes.forEach(c => el.classList.toggle(c));
                    if(targetId === 'mobile-menu') document.getElementById('mobile-menu-overlay').classList.toggle('hidden');
                });
            }

            openEpisode(sId, eId) {
                const s = CatalogDB.find(x => x.id === sId);
                const e = s.episodes.find(x => x.id === eId);
                this.currentEp = e;

                ['modal-tag', 'modal-mobile-tag'].forEach(id => document.getElementById(id).textContent = s.title);
                document.getElementById('modal-title').textContent = e.title;
                document.getElementById('modal-body').innerHTML = e.content; 
                const videoLink = `https://www.youtube.com/results?search_query=${encodeURIComponent(e.videoQuery)}`;
                document.getElementById('btn-video').href = videoLink;
                document.getElementById('btn-video-mobile').href = videoLink;
                
                this.updateModalBtn();
                
                const m = document.getElementById('episode-modal');
                m.classList.remove('hidden');
                setTimeout(() => {
                    m.classList.remove('opacity-0');
                    DOMHelper.focusTrap('episode-modal');
                }, 10);
            }

            closeModal() {
                const m = document.getElementById('episode-modal');
                m.classList.add('opacity-0');
                setTimeout(() => m.classList.add('hidden'), 300);
            }

            toggleComplete() {
                const id = this.currentEp.id;
                let p = [...this.state.state.progress]; // Copy array
                const idx = p.indexOf(id);
                
                if(idx > -1) {
                    p.splice(idx, 1);
                } else {
                    p.push(id);
                    this.showToast("Concluído! +XP");
                }
                
                this.state.update('progress', p);
                this.updateModalBtn();
            }

            updateModalBtn() {
                const isDone = this.state.state.progress.includes(this.currentEp.id);
                ['btn-concluir', 'btn-concluir-mobile'].forEach(id => {
                    const btn = document.getElementById(id);
                    if(btn) {
                        const isMobile = id.includes('mobile');
                        if(isDone) {
                            btn.className = isMobile ? 
                                "flex-1 bg-green-600 text-white py-3 rounded-xl font-bold text-xs uppercase btn-press flex items-center justify-center gap-2" : 
                                "w-full py-4 bg-green-600 text-white rounded-xl font-bold text-xs uppercase tracking-widest transition flex items-center justify-center gap-3 btn-press";
                            btn.innerHTML = isMobile ? '<i class="fas fa-check"></i> Concluído' : '<i class="fas fa-check"></i> Concluído';
                        } else {
                            btn.className = isMobile ? 
                                "flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold text-xs uppercase btn-press" : 
                                "w-full py-4 bg-slate-800 hover:bg-green-600 text-white rounded-xl font-bold text-xs uppercase tracking-widest transition flex items-center justify-center gap-3 border border-white/5 group btn-press";
                            btn.innerHTML = isMobile ? "Concluir" : '<i class="far fa-circle group-hover:scale-110 transition"></i> Concluir';
                        }
                    }
                });
            }

            showToast(msg, type='success') {
                const c = document.getElementById('toast-container');
                const t = document.createElement('div');
                t.className = `bg-slate-800 text-white px-4 py-3 rounded-xl shadow-2xl flex items-center gap-3 text-sm font-bold animate-fade-in border border-white/10 backdrop-blur-md`;
                t.innerHTML = `<i class="fas ${type==='error'?'fa-exclamation-circle text-red-500':'fa-check-circle text-green-500'}"></i> ${msg}`;
                c.appendChild(t); setTimeout(() => t.remove(), 3000);
            }

            calcMedia() {
                const v = [1,2,3,4,5].map(i => parseFloat(document.getElementById(`n${i}`).value)||0);
                const m = (v.reduce((a,b)=>a+b,0)/5).toFixed(1);
                const r = document.getElementById('res-calc');
                r.textContent = `Média Estimada: ${m}`;
                r.classList.remove('hidden');
                r.classList.add('animate-fade-in');
            }

            async handleChat(e) {
                e.preventDefault();
                const inp = document.getElementById('chat-input');
                const msg = inp.value.trim();
                if(!msg) return;

                const box = document.getElementById('chat-messages');
                this.addChatMsg(msg, 'user');
                inp.value = "";

                const API_KEY = ""; // Mantenha vazio no front-end
                
                if(!API_KEY) {
                    setTimeout(() => this.addChatMsg("⚠️ <strong>Modo Demo:</strong> A IA requer uma chave de API configurada no backend.", 'bot'), 600);
                    return;
                }

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                        method: 'POST', headers: {'Content-Type':'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: msg }] }], tools: [{ google_search: {} }] })
                    });
                    const data = await res.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "Erro na resposta.";
                    this.addChatMsg(marked.parse(text), 'bot');
                } catch(err) {
                    this.addChatMsg("Erro de conexão.", 'bot');
                }
            }

            addChatMsg(html, role) {
                const box = document.getElementById('chat-messages');
                const align = role === 'user' ? 'justify-end' : 'justify-start';
                const bg = role === 'user' ? 'bg-rose-600 text-white' : 'bg-slate-800 text-slate-300';
                
                box.innerHTML += `
                    <div class="flex ${align} animate-fade-in">
                        <div class="${bg} p-3 rounded-2xl ${role==='user'?'rounded-tr-none':'rounded-tl-none'} text-sm max-w-[85%] prose-chat">
                            ${html}
                        </div>
                    </div>
                `;
                box.scrollTop = box.scrollHeight;
            }

            search(term) {
                term = term.toLowerCase();
                if(!term) return this.renderCatalog();
                
                const filtered = CatalogDB.map(s => ({
                    ...s, episodes: s.episodes.filter(ep => ep.title.toLowerCase().includes(term))
                })).filter(s => s.episodes.length > 0);
                
                this.renderCatalog(filtered);
            }
        }

        // --- INIT ---
        const app = new AppController();
    </script>
</body>
</html>
